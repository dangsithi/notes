async function login() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    const message = document.getElementById('message');

    if (!username || !password) {
        message.textContent = 'Vui lòng nhập đầy đủ thông tin!';
        message.style.color = 'red';
        return;
    }

    const hashedPassword = CryptoJS.SHA256(password).toString();
    const endpoint = isRegisterMode ? 'register' : 'login';
    message.textContent = isRegisterMode ? 'Đang đăng ký...' : 'Đang kiểm tra...';

    try {
        const response = await fetch(SCRIPT_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ 
                action: endpoint, 
                username, 
                password: hashedPassword 
            })
        });
        const data = await response.json();

        message.textContent = data.message;
        message.style.color = data.success ? 'green' : 'red';

        if (data.success && !isRegisterMode) {
            localStorage.setItem('loggedInUser', username);
            window.location.href = 'notes.html';
        } else if (data.success && isRegisterMode) {
            switchToRegister();
        }
    } catch (error) {
        message.textContent = 'Lỗi kết nối: ' + error.message;
        message.style.color = 'red';
    }
}